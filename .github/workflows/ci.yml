name: CI

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    # Use the pinned Lean toolchain container for reproducibility
    container: leanprover/lean4:v4.12.0
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Lake version
        run: lake --version

      - name: Fetch dependencies
        run: lake update

      - name: Build
        run: lake build

      - name: Check for sorry/admit/axiom in tracked code
        run: |
          set -e
          echo "Scanning rh/ and ym/ for forbidden tokens..."
          if grep -R -nE '\\bsorry\\b|\\badmit\\b|^\\s*axiom\\b' rh ym; then
            echo 'Error: found sorry/admit/axiom in rh/ or ym/'
            exit 1
          fi
          echo "No forbidden tokens found in rh/ or ym/."
name: CI

on:
  push:
    branches: [ main, feat/**, chore/** ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install elan (Lean toolchain)
        uses: leanprover/elan-action@v1

      - name: Cache lake packages
        uses: actions/cache@v4
        with:
          path: |
            .lake
            lake-packages
          key: ${{ runner.os }}-lake-${{ hashFiles('lake-manifest.json') }}
          restore-keys: |
            ${{ runner.os }}-lake-

      - name: Lake build
        run: |
          lake update
          lake build

      - name: Verify (no sorries/axioms; key theorems present)
        run: |
          bash scripts/verify.sh
